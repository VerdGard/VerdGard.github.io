<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>蓝奏云解析 Pro - 移动优化版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #e0e5ec;
            --primary-color: #6c7ae0;
            --primary-color-dark: #5a66c0;
            --success-color: #4CAF50;
            --danger-color: #f44336;
            --text-color: #2d3748;
            --shadow-light: 8px 8px 16px #c5c8ce, -8px -8px 16px #ffffff;
            --shadow-inset: inset 4px 4px 8px #c5c8ce, inset -4px -4px 8px #ffffff;
            --radius: 20px;
        }

        /* 基础样式优化 */
        body {
            background: var(--bg-color);
            padding: 15px;
            -webkit-tap-highlight-color: transparent; /* 移除移动端点击高亮 */
        }

        /* 移动端自适应核心 */
        @media (max-width: 600px) {
            :root {
                --shadow-light: 5px 5px 10px #c5c8ce, -5px -5px 10px #ffffff;
                --radius: 15px;
            }
            h1 { font-size: 1.8rem !important; }
            .card { padding: 20px !important; }
            .form-options { grid-template-columns: 1fr !important; } /* 强制单列 */
            .action-buttons { grid-template-columns: 1fr !important; }
            .logo { width: 70px; height: 70px; font-size: 30px; }
        }

        .container { max-width: 1000px; margin: 0 auto; }

        /* 卡片与控件 */
        .card {
            background: var(--bg-color);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow-light);
            margin-bottom: 25px;
        }

        input, select {
            width: 100%;
            padding: 15px;
            border: none;
            background: var(--bg-color);
            border-radius: 12px;
            box-shadow: var(--shadow-inset);
            font-size: 16px; /* 防止 iOS 自动放大 */
        }

        .btn {
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            box-shadow: var(--shadow-light);
            cursor: pointer;
            transition: 0.2s;
            width: 100%;
        }

        .btn:active {
            box-shadow: var(--shadow-inset);
            transform: scale(0.98);
        }

        /* 列表优化 */
        .file-item {
            flex-direction: column; /* 移动端优先布局 */
            align-items: flex-start;
            gap: 15px;
        }

        @media (min-width: 600px) {
            .file-item { flex-direction: row; align-items: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header style="text-align:center; padding: 20px 0;">
            <div class="logo card" style="display:inline-flex; align-items:center; justify-content:center; border-radius:50%; margin-bottom:15px; color:var(--primary-color);">
                <i class="fas fa-cloud"></i>
            </div>
            <h1>蓝奏云解析</h1>
            <p style="opacity: 0.7;">支持单文件与文件夹静默解析</p>
        </header>

        <div class="card" style="padding: 10px; display: flex; gap: 10px;">
            <button class="btn" id="btn-file-mode" onclick="switchMode('file')" style="background:var(--primary-color); color:white;">文件解析</button>
            <button class="btn" id="btn-folder-mode" onclick="switchMode('folder')">文件夹解析</button>
        </div>

        <div class="card" id="main-form">
            <div id="input-group">
                <label><i class="fas fa-link"></i> 链接地址</label>
                <input type="text" id="target-url" placeholder="请输入蓝奏云地址..." style="margin: 10px 0 20px;">
                
                <label><i class="fas fa-key"></i> 提取密码 (可选)</label>
                <input type="text" id="target-pw" placeholder="没有密码请留空" style="margin: 10px 0 20px;">
            </div>

            <div class="form-options" style="display: grid; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label>响应格式</label>
                    <select id="api-type"><option value="json">JSON</option><option value="xml">XML</option></select>
                </div>
            </div>

            <button class="btn" onclick="startParse()" style="background: var(--primary-color); color: white;">
                <i class="fas fa-rocket"></i> 立即解析
            </button>
        </div>

        <div id="result-area" style="display:none;">
             </div>

        <footer style="text-align:center; font-size:12px; opacity:0.5; padding: 20px;">
            API 接口地址: <code id="api-endpoint">/lanzouyunapi.php</code>
        </footer>
    </div>

    <script>
        let currentMode = 'file';

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('btn-file-mode').style.cssText = mode === 'file' ? "background:var(--primary-color); color:white;" : "";
            document.getElementById('btn-folder-mode').style.cssText = mode === 'folder' ? "background:var(--primary-color); color:white;" : "";
        }

        async function startParse() {
            const url = document.getElementById('target-url').value;
            const pw = document.getElementById('target-pw').value;
            const type = document.getElementById('api-type').value;

            if(!url) return alert('请输入链接');

            // 构造 API 调用 (App 也可以直接调用此 URL)
            // 示例: domain.com/lanzouyunapi.php?url=xxx&pw=xxx&type=json
            const apiBase = 'lanzouyunapi.php';
            const params = new URLSearchParams({
                url: url,
                pw: pw,
                type: type,
                mode: 'auto'
            });

            try {
                const response = await fetch(`${apiBase}?${params.toString()}`);
                const data = await response.json();
                renderResult(data);
            } catch (e) {
                alert('解析请求失败，请检查服务端 PHP 文件是否存在');
            }
        }

        function renderResult(res) {
            const area = document.getElementById('result-area');
            area.style.display = 'block';
            
            if(res.code !== 200) {
                area.innerHTML = `<div class="card" style="color:var(--danger-color)">解析失败：${res.msg}</div>`;
                return;
            }

            // 动态构建结果界面
            const info = res.data;
            area.innerHTML = `
                <div class="card">
                    <h3 style="margin-bottom:15px; color:var(--primary-color)">解析结果</h3>
                    <p><b>文件名:</b> ${info.name || '文件夹内容'}</p>
                    <p><b>大小:</b> ${info.size || '-'}</p>
                    <div style="margin-top:20px;">
                        <input type="text" readonly value="${info.url || '无法获取直链'}" id="copy-target">
                        <button class="btn" onclick="copyLink()" style="margin-top:10px; background:var(--success-color); color:white;">复制直链</button>
                    </div>
                </div>
            `;
            area.scrollIntoView({behavior: 'smooth'});
        }

        function copyLink() {
            const copyText = document.getElementById("copy-target");
            copyText.select();
            document.execCommand("copy");
            alert("已复制到剪贴板");
        }
    </script>
</body>
</html>